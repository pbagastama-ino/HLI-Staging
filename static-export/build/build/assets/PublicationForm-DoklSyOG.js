import{r as w,q as I,m as q,x as $,c as E,o as i,w as C,a as t,b as n,d,t as l,e as P,u as M,l as U,f as _,h as L,i as p,n as f,j as v,v as j,s as N,B as R,k as S}from"./app-DANtfWd9.js";import{_ as G}from"./AdminLayout-Bkg2zEiT.js";import"./hligp-logo-CGFychJV.js";const z={class:"mb-6"},A={class:"flex justify-between items-center"},O={class:"text-xl font-semibold text-gray-800"},H={class:"text-sm text-gray-600 mt-1"},J={class:"flex space-x-3"},X={key:0,class:"mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg relative"},K={key:1,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg relative"},W={class:"bg-white shadow-sm rounded-lg p-6"},Q={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Y={class:"md:col-span-2"},Z={key:0,class:"mt-1 text-sm text-red-600"},ee={key:0,class:"mt-1 text-sm text-red-600"},te={key:0,class:"mt-1 text-sm text-red-600"},se={key:0,class:"mt-1 text-sm text-red-600"},oe={class:"flex items-center"},ae={class:"bg-white shadow-sm rounded-lg p-6"},re={class:"mb-6"},le={key:0,class:"mt-1 text-sm text-red-600"},ie={class:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md"},ne={class:"space-y-1 text-center"},de={key:0,class:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true"},ue={key:1,class:"mx-auto h-32 w-32 relative"},me=["src"],pe={class:"flex text-sm text-gray-600"},ce={for:"image",class:"relative cursor-pointer bg-white rounded-md font-medium text-[#4D9F95] hover:text-[#3d7f75] focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-[#4D9F95]"},ge={key:0,class:"mt-1 text-sm text-red-600"},fe={key:1,class:"mt-1 text-sm text-red-600"},be={class:"bg-white shadow-sm rounded-lg p-6"},ye={class:"space-y-6"},xe={key:0,class:"mt-1 text-sm text-red-600"},ve={class:"mt-1 text-sm text-gray-500"},he={key:0,class:"mt-1 text-sm text-red-600"},we={class:"mt-1 text-sm text-gray-500"},ke={key:0,class:"mt-1 text-sm text-red-600"},_e={class:"mt-1 text-sm text-gray-500"},Fe={class:"flex justify-end space-x-3"},Ce=["disabled"],De={key:0},Pe={key:1},Se={__name:"PublicationForm",props:{publication:{type:Object,default:null},user:{type:Object,required:!0}},setup(b){const r=b,k=w(!0),c=w(!1),y=w(null),F=w(null),x=w(null),s=I({title:r.publication?.title||"",text:r.publication?.text||"",image:null,category:r.publication?.category||"",published_date:r.publication?.published_date?r.publication.published_date.split("T")[0]:"",status:r.publication?.status||"draft",featured:r.publication?.featured||!1,meta_title:r.publication?.meta_title||"",meta_description:r.publication?.meta_description||"",meta_keywords:r.publication?.meta_keywords||""}),o=q(()=>r.$page?.props?.errors||{}),T=m=>{const e=m.target.files[0];if(x.value=null,e){if(!["image/jpeg","image/png","image/jpg","image/gif"].includes(e.type)){x.value="Please select a valid image file (JPEG, PNG, JPG, or GIF)",m.target.value="";return}const u=2*1024*1024;if(e.size>u){x.value="File size must be less than 2MB",m.target.value="";return}s.image=e;const g=new FileReader;g.onload=h=>{y.value=h.target.result},g.readAsDataURL(e)}},V=async()=>{if(c.value=!0,console.log("Current form values:",s),s.image instanceof File){const e=new FormData;e.append("title",s.title||""),e.append("text",s.text||""),e.append("category",s.category||""),e.append("status",s.status||"draft"),e.append("published_date",s.published_date||""),e.append("featured",s.featured?1:0),e.append("meta_title",s.meta_title||""),e.append("meta_description",s.meta_description||""),e.append("meta_keywords",s.meta_keywords||""),e.append("image",s.image),console.log("Using FormData for file upload:",s.image.name),console.log("FormData contents:",{title:e.get("title"),text:e.get("text"),category:e.get("category"),image:e.get("image"),imageType:s.image.type,imageSize:s.image.size});const a=r.publication?`/hli-admin/publications/${r.publication.id}`:"/hli-admin/publications";r.publication;try{r.publication&&e.append("_method","PATCH");const u=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||window.Laravel?.csrfToken||document.querySelector('input[name="_token"]')?.value;if(!u)throw new Error("CSRF token not found. Please refresh the page and try again.");const g=await R({method:"post",url:a,data:e,headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":u,"X-Requested-With":"XMLHttpRequest"}});console.log("Form submitted successfully with FormData"),c.value=!1,S.visit("/hli-admin/publications")}catch(u){if(console.error("Form submission errors:",u.response?.data?.errors||u.message),c.value=!1,u.response?.data?.errors){const g=u.response.data.errors,h=Object.values(g).flat();alert("Upload failed: "+h.join(", "))}else u.message?alert("Upload failed: "+u.message):alert("Upload failed. Please try again.")}}else{const e={title:s.title||"",text:s.text||"",category:s.category||"",status:s.status||"draft",published_date:s.published_date||"",featured:s.featured?1:0,meta_title:s.meta_title||"",meta_description:s.meta_description||"",meta_keywords:s.meta_keywords||""};console.log("Using regular object (no file):",e);const a=r.publication?`/hli-admin/publications/${r.publication.id}`:"/hli-admin/publications",u=r.publication?"patch":"post";S[u](a,e,{onSuccess:()=>{c.value=!1},onError:g=>{c.value=!1,console.error("Form submission errors:",g);const h=Object.values(g).flat();alert("Submission failed: "+h.join(", "))},onFinish:()=>{c.value=!1}})}},D=()=>{k.value=!1},B=()=>{s.image=null,y.value=null,x.value=null,F.value&&(F.value.value="")};return $(()=>{r.publication?.image_url&&(y.value=r.publication.image_url),setTimeout(()=>{k.value=!1},5e3)}),(m,e)=>(i(),E(G,{"current-page":(b.publication,"publications"),title:b.publication?"Edit Publication":"Create New Publication",user:b.user},{default:C(()=>[t("div",z,[t("div",A,[t("div",null,[t("h2",O,l(b.publication?"Edit Publication":"Create New Publication"),1),t("p",H,l(b.publication?"Update publication details":"Add a new publication"),1)]),t("div",J,[P(M(U),{href:"/hli-admin/publications",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"},{default:C(()=>[...e[9]||(e[9]=[_(" Cancel ",-1)])]),_:1})])])]),k.value&&m.$page.props.flash&&m.$page.props.flash.success?(i(),n("div",X,[t("button",{onClick:D,class:"absolute top-2 right-2 text-green-600 hover:text-green-800"},[...e[10]||(e[10]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),_(" "+l(m.$page.props.flash.success),1)])):d("",!0),k.value&&m.$page.props.flash&&m.$page.props.flash.error?(i(),n("div",K,[t("button",{onClick:D,class:"absolute top-2 right-2 text-red-600 hover:text-red-800"},[...e[11]||(e[11]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),_(" "+l(m.$page.props.flash.error),1)])):d("",!0),t("form",{onSubmit:L(V,["prevent"]),class:"space-y-6"},[t("div",W,[e[19]||(e[19]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Basic Information",-1)),t("div",Q,[t("div",Y,[e[12]||(e[12]=t("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-1"}," Title * ",-1)),p(t("input",{id:"title","onUpdate:modelValue":e[0]||(e[0]=a=>s.title=a),type:"text",required:"",class:f(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4D9F95] focus:border-transparent",{"border-red-500":o.value.title}])},null,2),[[v,s.title]]),o.value.title?(i(),n("p",Z,l(o.value.title),1)):d("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{for:"category",class:"block text-sm font-medium text-gray-700 mb-1"}," Category * ",-1)),p(t("select",{id:"category","onUpdate:modelValue":e[1]||(e[1]=a=>s.category=a),required:"",class:f(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4D9F95] focus:border-transparent",{"border-red-500":o.value.category}])},[...e[13]||(e[13]=[t("option",{value:""},"Select Category",-1),t("option",{value:"press-release"},"Press Release",-1),t("option",{value:"company-activities"},"Company Activities",-1),t("option",{value:"life-at-hli"},"Life at HLI",-1)])],2),[[j,s.category]]),o.value.category?(i(),n("p",ee,l(o.value.category),1)):d("",!0)]),t("div",null,[e[16]||(e[16]=t("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-1"}," Status * ",-1)),p(t("select",{id:"status","onUpdate:modelValue":e[2]||(e[2]=a=>s.status=a),required:"",class:f(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4D9F95] focus:border-transparent",{"border-red-500":o.value.status}])},[...e[15]||(e[15]=[t("option",{value:"draft"},"Draft",-1),t("option",{value:"published"},"Published",-1),t("option",{value:"archived"},"Archived",-1)])],2),[[j,s.status]]),o.value.status?(i(),n("p",te,l(o.value.status),1)):d("",!0)]),t("div",null,[e[17]||(e[17]=t("label",{for:"published_date",class:"block text-sm font-medium text-gray-700 mb-1"}," Published Date ",-1)),p(t("input",{id:"published_date","onUpdate:modelValue":e[3]||(e[3]=a=>s.published_date=a),type:"date",class:f(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4D9F95] focus:border-transparent",{"border-red-500":o.value.published_date}])},null,2),[[v,s.published_date]]),o.value.published_date?(i(),n("p",se,l(o.value.published_date),1)):d("",!0)]),t("div",oe,[p(t("input",{id:"featured","onUpdate:modelValue":e[4]||(e[4]=a=>s.featured=a),type:"checkbox",class:"h-4 w-4 text-[#4D9F95] focus:ring-[#4D9F95] border-gray-300 rounded"},null,512),[[N,s.featured]]),e[18]||(e[18]=t("label",{for:"featured",class:"ml-2 block text-sm text-gray-900"}," Featured Publication ",-1))])])]),t("div",ae,[e[26]||(e[26]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Content",-1)),t("div",re,[e[20]||(e[20]=t("label",{for:"text",class:"block text-sm font-medium text-gray-700 mb-1"}," Content * ",-1)),p(t("textarea",{id:"text","onUpdate:modelValue":e[5]||(e[5]=a=>s.text=a),rows:"10",required:"",class:f(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4D9F95] focus:border-transparent",{"border-red-500":o.value.text}]),placeholder:"Write your publication content here..."},null,2),[[v,s.text]]),o.value.text?(i(),n("p",le,l(o.value.text),1)):d("",!0)]),t("div",null,[e[25]||(e[25]=t("label",{for:"image",class:"block text-sm font-medium text-gray-700 mb-1"}," Featured Image ",-1)),t("div",ie,[t("div",ne,[y.value?d("",!0):(i(),n("svg",de,[...e[21]||(e[21]=[t("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])),y.value?(i(),n("div",ue,[t("img",{src:y.value,alt:"Preview",class:"h-32 w-32 object-cover rounded-lg"},null,8,me),t("button",{type:"button",onClick:B,class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600",title:"Remove image"}," Ã— ")])):d("",!0),t("div",pe,[t("label",ce,[e[22]||(e[22]=t("span",null,"Upload a file",-1)),t("input",{id:"image",ref_key:"imageInput",ref:F,type:"file",accept:"image/*",onChange:T,class:"sr-only"},null,544)]),e[23]||(e[23]=t("p",{class:"pl-1"},"or drag and drop",-1))]),e[24]||(e[24]=t("p",{class:"text-xs text-gray-500"},"PNG, JPG, GIF up to 2MB",-1))])]),o.value.image?(i(),n("p",ge,l(o.value.image),1)):d("",!0),x.value?(i(),n("p",fe,l(x.value),1)):d("",!0)])]),t("div",be,[e[30]||(e[30]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"SEO Settings",-1)),t("div",ye,[t("div",null,[e[27]||(e[27]=t("label",{for:"meta_title",class:"block text-sm font-medium text-gray-700 mb-1"}," Meta Title ",-1)),p(t("input",{id:"meta_title","onUpdate:modelValue":e[6]||(e[6]=a=>s.meta_title=a),type:"text",maxlength:"255",class:f(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4D9F95] focus:border-transparent",{"border-red-500":o.value.meta_title}])},null,2),[[v,s.meta_title]]),o.value.meta_title?(i(),n("p",xe,l(o.value.meta_title),1)):d("",!0),t("p",ve,l(s.meta_title?.length||0)+"/255 characters",1)]),t("div",null,[e[28]||(e[28]=t("label",{for:"meta_description",class:"block text-sm font-medium text-gray-700 mb-1"}," Meta Description ",-1)),p(t("textarea",{id:"meta_description","onUpdate:modelValue":e[7]||(e[7]=a=>s.meta_description=a),rows:"3",maxlength:"500",class:f(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4D9F95] focus:border-transparent",{"border-red-500":o.value.meta_description}])},null,2),[[v,s.meta_description]]),o.value.meta_description?(i(),n("p",he,l(o.value.meta_description),1)):d("",!0),t("p",we,l(s.meta_description?.length||0)+"/500 characters",1)]),t("div",null,[e[29]||(e[29]=t("label",{for:"meta_keywords",class:"block text-sm font-medium text-gray-700 mb-1"}," Meta Keywords ",-1)),p(t("input",{id:"meta_keywords","onUpdate:modelValue":e[8]||(e[8]=a=>s.meta_keywords=a),type:"text",maxlength:"500",class:f(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4D9F95] focus:border-transparent",{"border-red-500":o.value.meta_keywords}]),placeholder:"keyword1, keyword2, keyword3"},null,2),[[v,s.meta_keywords]]),o.value.meta_keywords?(i(),n("p",ke,l(o.value.meta_keywords),1)):d("",!0),t("p",_e,l(s.meta_keywords?.length||0)+"/500 characters",1)])])]),t("div",Fe,[P(M(U),{href:"/hli-admin/publications",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"},{default:C(()=>[...e[31]||(e[31]=[_(" Cancel ",-1)])]),_:1}),t("button",{type:"submit",disabled:c.value,class:"px-4 py-2 text-sm font-medium text-white bg-[#4D9F95] rounded-lg hover:bg-[#3d7f75] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#4D9F95] disabled:opacity-50 disabled:cursor-not-allowed"},[c.value?(i(),n("span",De,"Saving...")):(i(),n("span",Pe,l(b.publication?"Update Publication":"Create Publication"),1))],8,Ce)])],32)]),_:1},8,["current-page","title","user"]))}};export{Se as default};
